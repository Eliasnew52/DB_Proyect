{% extends 'base.html' %}
{% load static %}

{% block title %}
    Editar Producto
{% endblock title %}

{% block content %}
<div class="page-header">
    <div class="page-title">
        <h4>Editar Producto</h4>
        <h6>Actualiza los detalles de tu producto</h6>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row">
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Nombre del Producto</label>
                        <input type="text" name="nombre" value="{{ product.nombre }}" class="form-control">
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Categoría</label>
                        <select name="categoria" class="select form-control">
                            {% for categoria in categorias %}
                                <option value="{{ categoria.id }}" {% if categoria.id == product.categoria.id %}selected{% endif %}>{{ categoria.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Precio de Venta</label>
                        <input type="text" name="precio_venta" value="{{ product.precio_venta }}" class="form-control">
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Precio de Compra</label>
                        <input type="text" name="precio_compra" value="{{ product.precio_compra }}" class="form-control">
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Stock Mínimo</label>
                        <input type="text" name="stock_minimo" value="{{ product.stock_minimo }}" class="form-control">
                    </div>
                </div>
                <div class="col-lg-3 col-sm-6 col-12">
                    <div class="form-group">
                        <label>Stock</label>
                        <input type="text" name="stock" value="{{ product.stock }}" class="form-control">
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group">
                        <label>Descripción</label>
                        <textarea name="descripcion" class="form-control">{{ product.descripcion }}</textarea>
                    </div>
                </div>
                <div class="col-lg-12">
                    <div class="form-group">
                        <label>Imagen del Producto</label>
                        <div class="image-upload">
                            <input type="file" name="imagen" id="imagen-input" onchange="previewImage(event)">
                            <div class="image-uploads">
                                <img src="{% static 'assets/img/icons/upload.svg' %}" alt="img">
                                <h4>Arrastra y suelta un archivo para subir</h4>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12">
                    <div class="product-list">
                        <ul class="row">
                            <li class="ps-0" id="productviewscontainer">
                                <div class="productviews">
                                    <div class="productviewsimg">
                                        <img id="imagen-preview" src="{{ product.imagen.url }}" alt="img">
                                    </div>
                                    <div class="productviewscontent">
                                        <div class="productviewsname">
                                            <h2 id="productname">{{ product.imagen.url }}</h2>
                                        {% if image_size %}
                                            <h3 id="productimagesize">{{ image_size|filesizeformat }}</h3>
                                        {% endif %}
                                    </div>
                                    <a href="javascript:void(0);" class="hideset" onclick="clearImage()">x</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-lg-12">
                    <button type="submit" class="btn btn-submit me-2">Guardar</button>
                    <a href="{% url 'list_product' %}" class="btn btn-cancel">Cancelar</a>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    function previewImage(event) {
        var reader = new FileReader();
        reader.onload = function(){
            
            var output = document.getElementById('imagen-preview');
            output.src = reader.result;
            document.querySelector('#productviewscontainer').style.display = 'block';
            document.querySelector('#productname').innerText = event.target.files[0].name;
            document.querySelector('#productimagesize').innerText = (event.target.files[0].size / 1024).toFixed(2) + ' KB';
        };
        reader.readAsDataURL(event.target.files[0]);
    }
    
    function clearImage() {
        var input = document.getElementById('imagen-input');
        var preview = document.getElementById('imagen-preview');
        input.value = '';

    }
    </script>
{% endblock content %}
